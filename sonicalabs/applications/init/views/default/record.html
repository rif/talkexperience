{{extend 'layout.html'}}

<h3>{{=T('Record Your Experience')}}</h3>

{{=form.custom.begin}}
<table>
    <tbody>
        <tr><td>{{=T('Title')}}</td><td>{{=form.custom.widget.title}}</td></tr>
        <tr><td>{{=T('Description')}}</td><td>{{=form.custom.widget.description}}</td></tr>
        <tr><td>{{=T('Keywords')}}</td><td>{{=form.custom.widget.keywords}}</td><td><img src="{{=URL('static','/images/help.png')}}" alt="help" rel="popover" data-trigger="hover" title="{{=T('Keywords')}}" data-content="{{=T('Representative words for the recording.')}}"/></td></tr>
        <tr><td>{{=T('Category')}}</td><td>{{=form.custom.widget.category}}</td></tr>
        <tr id="sounds_uuid__row"><td></td><td>{{=form.custom.widget.uuid}}</td></tr>
        <tr><td>{{=T('Language')}}</td><td>{{=form.custom.widget.language}}</td></tr>
        <tr><td><span class="form_split">Time capsule</span><img src="{{=URL('static','/images/help.png')}}" alt="help" rel="popover" data-trigger="hover" title="{{=T('Time capsule')}}" data-content="{{=T('Use when you want the sound to be released to a later date. An email will be send to the specified address.)}}"/></td></tr>
        <tr><td>{{=T('Release date')}}</td><td>{{=form.custom.widget.release_date}}</td></tr>
        <tr><td>{{=T('Email')}}</td><td>{{=form.custom.widget.email}}</td></tr>
        <tr>
          <td>Record an Experience</td>
          <td>
            <a style="display:none" href="#" class="btn btn-large btn-danger ready" id="rec-link">{{=T('Start recording')}}</a>
            <span id="wami"></span>
			<noscript>          
              <p>{{=T('Please enable JavaScript and Flash to use the recorder feature.')}}</p>              
            </noscript> 
      <div id="status"></div>
          </td>
      </tr>
    </tbody>
</table>
{{=form.custom.submit}}
{{=form.custom.end}}

<!-- swfobject is a commonly used library to embed Flash content -->
<script type="text/javascript"
	src="https://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>
<link href="{{=URL('static','css/select2.css')}}" rel="stylesheet" type="text/css" />
<script src="{{=URL('static','js/select2.min.js')}}" type="text/javascript"></script>
<!-- Setup the recorder interface -->
<script type="text/javascript" src="{{=URL('static', 'js/recorder.js')}}"></script>

<script type="text/javascript">
  $(function(){
  	$("#sounds_language").select2({width:"315px",});
  	$("#sounds_category").select2({width:"315px",});
    $("#sounds_uuid__row").hide();
  	Wami.setup({  		
			id : "wami",
			swfUrl : "{{=URL('static', 'js/Wami.swf')}}",
      onReady : function() {
        Wami.hide();
        $("#rec-link").fadeIn();        
      },
  	});     
	$("#rec-link").click(function(){
		if($('#rec-link').hasClass('ready')){
			$("#status").text("{{=T('Recording...')}}");
			Wami.startRecording("http://avocadosoft.ro:6060/record?uuid="+$("#sounds_uuid").val());			
			//Wami.startRecording("http://localhost:6060/record?uuid="+$("#sounds_uuid").val());
			$(this).removeClass('ready');
      		$(this).text("{{=T('Stop recording')}}");
		} else{
			$("#status").text("");
			Wami.stopRecording();			
			$(this).addClass('ready');
      		$(this).text("{{=T('Start recording')}}");
		}
		return false;
	});
  });
</script>
