{{extend 'layout.html'}}


<div class="row">
{{=form.custom.begin}}
<div class="span6">
    <h3>{{=T('Upload an Experience')}}</h3>
<table>
    <tbody>
        <tr><td>{{=T('Title')}}</td><td>{{=form.custom.widget.title}}</td></tr>
        <tr><td>{{=T('Description')}}</td><td>{{=form.custom.widget.description}}</td></tr>
        <tr>
            <td>
                {{=T('Keywords')}}</td><td>{{=form.custom.widget.keywords}}
                <img src="{{=URL('static','/images/help.png')}}" alt="help" rel="popover" data-trigger="hover" title="{{=T('Keywords')}}" data-content="{{=T('Representative words for the recording.')}}"/>
            </td>
        </tr>
        <tr><td>{{=T('Category')}}</td><td>{{=form.custom.widget.category}}</td></tr>
        <tr id="sounds_uuid__row"><td></td><td>{{=form.custom.widget.uuid}}</td></tr>
        <tr><td>{{=T('Language')}}</td><td>{{=form.custom.widget.language}}</td></tr>
        <tr>
            <td>
                {{=T('Picture')}}</td><td>{{=form.custom.widget.picture}}
                <img src="{{=URL('static','/images/help.png')}}" alt="help" rel="popover" data-trigger="hover" title="{{=T('Picture')}}" data-content="{{=T('Representative picture for the recording.')}}"/></td>
            </td>
        </tr>
    </tbody>
</table>
</div>
<div class="span5" style="margin-top: 50px;">
    <h4><span class="form_split">Time capsule</span><img src="{{=URL('static','/images/help.png')}}" alt="help" rel="popover" data-trigger="hover" title="{{=T('Time capsule')}}" data-content="{{=T('Use when you want the experience to be released at a later date. An email will be sent to the address provided.')}}"/></h4>
<table>
    <tbody>
        <tr><td>{{=T('Release date')}}</td><td>{{=form.custom.widget.release_date}}</td></tr>
        <tr><td>{{=T('Email')}}</td><td>{{=form.custom.widget.email}}</td></tr>
        <tr><td>{{=T('Comments')}}</td><td>{{=form.custom.widget.comments}}</td></tr>
        <tr>
          <td>Upload an Experience</td>
          <td>
            <div id="fine-uploader">       
              <noscript>          
                <p>{{=T("Please enable JavaScript to use the file uploader.")}}</p>
                <!-- or put a simple form for upload here -->
              </noscript>         
            </div>
          </td>
      </tr>
    </tbody>
</table>
</div>
</div>
<div class="row">
    <div class="center">
        <button id="share-button" disabled="disabled" class="btn btn-large btn-green">{{=T('Share')}}</button>
    </div>
</div>
{{=form.custom.end}}

<div id="uploading" style="display:none">
  <h4>{{=T('Uploading...')}}</h4>
  <progress min="0" max="100" value="0">0% complete</progress> <br/>
</div>

<link href="{{=URL('static','css/select2.css')}}" rel="stylesheet" type="text/css" />
<link href="{{=URL('static','css/fineuploader.css')}}" rel="stylesheet" type="text/css" />
<script src="{{=URL('static','js/select2.min.js')}}" type="text/javascript"></script>
<script src="{{=URL('static','js/fineuploader-3.0.min.js')}}" type="text/javascript"></script>

<script type="text/javascript">
$(function(){
  $('[rel=popover]').popover();
  $("#sounds_language").select2({width:"315px",});
  $("#sounds_category").select2({width:"315px",});
  $("#sounds_uuid__row").hide();
 
  var uploader = new qq.FineUploader({
    // pass the dom node (ex. $(selector)[0] for jQuery users)
    uploadButtonText: "{{=T('Browse')}}",
    multiple: false,
    //debug: true,
    element: $("#fine-uploader")[0],
    // path to server-side upload script    
    request: {
        //endpoint: 'http://avocadosoft.ro:6060/process',
        endpoint: 'http://localhost:6060/process',
        params: {uuid: $("#sounds_uuid").val()},
    },
    validation: {
        allowedExtensions: ['mp3', 'wav', 'ogg', 'oga', 'aac', 'mp4', 'mp2', 'flac', 'au', 'ac3'],
    },
    callbacks: {
        onSubmit: function(id, fileName){            
          $(".qq-upload-button").hide();
        },
        onComplete: function(id, fileName){            
          $("#file-uploader").replaceWith('<h4 id="filename">Experience name: ' + fileName + '</h4>');
          $.get("{{=URL('default','init_sound')}}/" + $("#sounds_uuid").val(), function(){
            $("#share-button").removeAttr("disabled");  
          });          
        }
    }
  });
  $("form").submit(function(){
    if($(".qq-upload-file").length == 0){      
      alert("Please upload an audio file!");
      return false;
    } 
    return true;
  });  
});
</script>
